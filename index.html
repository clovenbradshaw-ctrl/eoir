<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOQL Data Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .tabs {
            display: flex;
            gap: 4px;
            padding: 8px 12px;
            background: #161b22;
            border-bottom: 1px solid #30363d;
        }

        .tab {
            padding: 8px 16px;
            background: #21262d;
            border: none;
            border-radius: 6px;
            color: #8b949e;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background: #30363d;
        }

        .tab.active {
            background: #388bfd;
            color: white;
        }

        .tab .count {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .table-container {
            flex: 1;
            overflow: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }

        th {
            background: #161b22;
            color: #8b949e;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #161b22;
        }

        tr.selected {
            background: #1f3a5f;
        }

        tr.selected:hover {
            background: #234875;
        }

        .checkbox-cell {
            width: 40px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #388bfd;
        }

        .col-id {
            width: 150px;
        }

        .col-from, .col-to, .col-type {
            width: 180px;
        }

        .col-properties {
            min-width: 200px;
        }

        .properties-json {
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 12px;
            color: #7ee787;
        }

        .add-field {
            color: #8b949e;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .add-field:hover {
            color: #c9d1d9;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background: #161b22;
            border-top: 1px solid #30363d;
            font-size: 13px;
            color: #8b949e;
        }

        .status-left {
            display: flex;
            gap: 16px;
        }

        .status-center {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3fb950;
        }

        .status-dot.secondary {
            background: #388bfd;
        }

        .toolbar {
            display: flex;
            justify-content: flex-end;
            padding: 8px 16px;
            background: #161b22;
        }

        .toolbar-btn {
            background: none;
            border: none;
            color: #8b949e;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 18px;
        }

        .toolbar-btn:hover {
            color: #c9d1d9;
        }

        .selection-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .selection-indicator::before {
            content: '';
            width: 4px;
            height: 4px;
            background: #8b949e;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="tabs">
            <button class="tab" data-tab="my-data">My Data <span class="count">0</span></button>
            <button class="tab" data-tab="sample">sample <span class="count">0</span></button>
            <button class="tab active" data-tab="relationships">sample - Relationships <span class="count" id="record-count">97</span></button>
        </div>

        <div class="toolbar">
            <button class="toolbar-btn">+</button>
            <button class="toolbar-btn">v</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th class="checkbox-cell">
                            <input type="checkbox" id="select-all" title="Select all">
                        </th>
                        <th class="col-id">Aa id</th>
                        <th class="col-from">Aa from</th>
                        <th class="col-to">Aa to</th>
                        <th class="col-type">Aa type</th>
                        <th class="col-properties">{} properties</th>
                        <th><span class="add-field">+ Add field</span></th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="status-bar">
            <div class="status-left">
                <span id="total-records">97 records</span>
                <span class="selection-indicator" id="selected-count">0 selected</span>
            </div>
            <div class="status-center">
                <span class="status-dot"></span>
                <span class="status-dot secondary"></span>
                <span>EO Compliant</span>
            </div>
            <div class="status-right">
                <span>Just now</span>
            </div>
        </div>
    </div>

    <script>
        // Sample data generation
        function generateSampleData(count) {
            const types = ['RELATES_TO', 'CONTAINS', 'REFERENCES', 'DERIVED_FROM', 'DEPENDS_ON'];
            const data = [];

            for (let i = 0; i < count; i++) {
                data.push({
                    id: `rel_${String(i + 1).padStart(4, '0')}`,
                    from: `node_${Math.floor(Math.random() * 50) + 1}`,
                    to: `node_${Math.floor(Math.random() * 50) + 1}`,
                    type: types[Math.floor(Math.random() * types.length)],
                    properties: i % 3 === 0 ? {} : null
                });
            }

            return data;
        }

        // State management
        const state = {
            data: generateSampleData(97),
            selectedIds: new Set()
        };

        // DOM elements
        const tableBody = document.getElementById('table-body');
        const selectAllCheckbox = document.getElementById('select-all');
        const selectedCountEl = document.getElementById('selected-count');

        // Render table rows
        function renderTable() {
            tableBody.innerHTML = '';

            state.data.forEach((row) => {
                const tr = document.createElement('tr');
                const isSelected = state.selectedIds.has(row.id);

                if (isSelected) {
                    tr.classList.add('selected');
                }

                tr.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox"
                               data-id="${row.id}"
                               ${isSelected ? 'checked' : ''}>
                    </td>
                    <td class="col-id">${row.id}</td>
                    <td class="col-from">${row.from}</td>
                    <td class="col-to">${row.to}</td>
                    <td class="col-type">${row.type}</td>
                    <td class="col-properties">
                        ${row.properties !== null ? '<span class="properties-json">{}</span>' : ''}
                    </td>
                    <td></td>
                `;

                tableBody.appendChild(tr);
            });

            updateSelectionUI();
        }

        // Update selection count display
        function updateSelectionUI() {
            const count = state.selectedIds.size;
            selectedCountEl.textContent = `${count} selected`;

            // Update "select all" checkbox state
            if (count === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (count === state.data.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // Handle individual row checkbox click
        // FIX: Previously this was incorrectly selecting multiple rows due to event bubbling
        // and improper event target handling. Now we properly handle single row selection.
        function handleRowCheckboxClick(event) {
            // Only process clicks on checkbox inputs
            if (event.target.type !== 'checkbox') {
                return;
            }

            // Ignore the "select all" checkbox - it has its own handler
            if (event.target.id === 'select-all') {
                return;
            }

            const checkbox = event.target;
            const rowId = checkbox.dataset.id;

            // FIX: Only toggle the single row that was clicked
            // Previously, the bug was caused by iterating over all checkboxes
            // or using querySelectorAll incorrectly
            if (checkbox.checked) {
                state.selectedIds.add(rowId);
            } else {
                state.selectedIds.delete(rowId);
            }

            // Update just this row's visual state
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                row.classList.add('selected');
            } else {
                row.classList.remove('selected');
            }

            updateSelectionUI();
        }

        // Handle "select all" checkbox
        function handleSelectAll(event) {
            const isChecked = event.target.checked;

            if (isChecked) {
                // Select all rows
                state.data.forEach(row => state.selectedIds.add(row.id));
            } else {
                // Deselect all rows
                state.selectedIds.clear();
            }

            // Update all checkboxes and row styles
            const checkboxes = tableBody.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = isChecked;
                const row = cb.closest('tr');
                if (isChecked) {
                    row.classList.add('selected');
                } else {
                    row.classList.remove('selected');
                }
            });

            updateSelectionUI();
        }

        // Event listeners
        // FIX: Use event delegation on the table body, not on individual checkboxes
        // This prevents the previous bug where event listeners were being attached
        // incorrectly causing multiple selections
        tableBody.addEventListener('click', handleRowCheckboxClick);
        selectAllCheckbox.addEventListener('change', handleSelectAll);

        // Tab switching (for demo purposes)
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

        // Initial render
        renderTable();
    </script>
</body>
</html>
